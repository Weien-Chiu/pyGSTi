
<StyledSplitter@Splitter>
    strip_size: '7pt'

<FixedHeightButton@Button>
    size_hint_y: None
    height: 40
#    bgcolor: (0, 0, 0, 0)
#    canvas.before:
#        Color:
#            rgba: root.bgcolor
#        Rectangle:
#            pos: self.pos
#            size: self.size


<FixedHeightLabel>
    size_hint_y: None
    height: 40
    bgcolor: (0, 0, 0, 0)
    canvas.before:
        Color:
            rgba: root.bgcolor
        Rectangle:
            pos: self.pos
            size: self.size

<NameDialog>
    BoxLayout:
        pos: root.pos
        orientation: "vertical"

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 60

            TextInput:
                id: name_input
                text: root.text

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 60
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Update"
                on_release: root.update(root, name_input.text)

    
<RootExplorerWidget>:
    id: root_id
    orientation: 'vertical'
    #StyledSplitter:
    #    id: top_bar_splitter
    #    sizable_from: 'bottom'
    #    size_hint_y: None
    #    height: 100
        
    BorderedBoxLayout:
        id: top_bar
        orientation: 'horizontal'
        size_hint_y: None
        height: 100

        ToggleButton:
            id: library_mode_button
            text: 'Library'
            on_release: root.change_mode('Library')
            group: 'mode'
            state: 'down'
        ToggleButton:
            id: create_mode_button
            text: 'Create'
            on_release: root.change_mode('Create')
            group: 'mode'
        ToggleButton:
            id: analysis_mode_button
            text: 'Analysis'
            on_release: root.change_mode('Analysis')
            group: 'mode'

    BoxLayout:
        id: main_strip
        orientation: 'horizontal'
    
        StyledSplitter:  # Results dir navigator
            id: import_sidebar_splitter
            sizable_from: 'right'
            size_hint_x: None
            width: 500
            min_size: 0
            max_size: 1000

            Accordion:
                id: import_sidebar
                orientation: 'vertical'

                CustomAccordionItem:
                    title: "Import from directory"

                    BoxLayout:
                        orientation: 'vertical'
    
                        FixedHeightButton:
                            text: 'Open Directory...'
                            on_release: root.show_load_root_dialog()
                            background_color: (0, 0.3, 0.4, 1)
                            background_normal: ''
        
                        FixedHeightLabel:
                            text: "Available e-designs:"

                        AnchorLayout:
                            anchor_x: 'center'
                            anchor_y: 'center'
                            padding: (20, 5)
                            BoxLayout:
                                orientation: 'vertical'
        
                                ResultsDirSelectorWidget:
                                    id: results_dir_selector
                
                                FixedHeightButton:
                                    text: 'Import selected E-design'
                                    on_release: root.import_edesign(include_children=False)
                                    background_color: (0, 0.3, 0.4, 1)
                                    background_normal: ''
                
                                FixedHeightButton:
                                    text: 'Import E-design w/children'
                                    on_release: root.import_edesign(include_children=True)
                                    background_color: (0, 0.3, 0.4, 1)
                                    background_normal: ''

            
                        ResultsDirDetailSelectorWidget:
                            id: results_dir_detail_selector
                            results_dir_selector_widget: results_dir_selector
                            model_list_widget: model_stack
        
                        FixedHeightLabel:
                            text: "Available models:"

                        AnchorLayout:
                            anchor_x: 'center'
                            anchor_y: 'center'
                            padding: (20, 5)
                            BoxLayout:
                                orientation: 'vertical'
                                ScrollView:
                                    do_scroll_x: False
                                    StackLayout:
                                        size_hint_y: None
                                        height: 60 * len(self.children)
                                        id: model_stack

                                FixedHeightButton:
                                    text: 'Import selected model(s)'
                                    on_release: root.import_models()
                                    background_color: (0, 0.3, 0.4, 1)
                                    background_normal: ''

                                FixedHeightButton:
                                    text: 'Import all model(s)'
                                    on_release: root.import_models(include_all=True)
                                    background_color: (0, 0.3, 0.4, 1)
                                    background_normal: ''

                                FixedHeightButton:
                                    text: 'Import all e-designs & models'
                                    on_release: root.import_all()
                                    background_color: (0.3, 0.3, 0.4, 1)
                                    background_normal: ''

    
                CustomAccordionItem:
                    title: "Import from file"

                    StackLayout:

                        FixedHeightButton:
                            text: 'Import dataset from file...'
                            on_release: root.import_dataset_from_file()
                        
                        FixedHeightButton:
                            text: 'Import model from file...'
                            on_release: root.import_model_from_file()

                CustomAccordionItem:
                    title: "Save and load library"

                    StackLayout:
                        FixedHeightButton:
                            text: 'Open library...'
                            on_release: root.open_library()

                        FixedHeightButton:
                            text: "Open analysis..."
                            on_release: root.open_analysis()

                        FixedHeightButton:
                            text: 'Save library'
                            on_release: root.resave_library()

                        FixedHeightButton:
                            text: 'Save library as...'
                            on_release: root.save_library()

                #FixedHeightButton:
                #    text: 'Import all models'
                #    on_release: root.import_all()


        StyledSplitter:  # Add-item sidebar
            id: add_item_sidebar_splitter
            sizable_from: 'right'
            size_hint_x: None
            width: 500
            min_size: 0
            max_size: 1000

            BorderedBoxLayout:
                id: add_item_sidebar
                orientation: 'vertical'

                FixedHeightLabel:
                    text: 'Create figure'
                    bgcolor: (0, 0.4, 0.6, 1)
            
        BoxLayout:  # Library of models, edesigns, and datasets (associated w/edesigns)
            id: library_area
            orientation: 'vertical'

            FixedHeightLabel:
                text: 'Experiment designs'
                bgcolor: (0, 0.4, 0.6, 1)
                
            ScrollView:
                StackLayout:
                    id: edesign_library_list

            FixedHeightLabel:
                text: 'Data sets'
                bgcolor: (0, 0.4, 0.6, 1)
                
            ScrollView:
                StackLayout:
                    id: dataset_library_list
                    
            FixedHeightLabel:
                text: 'Models'
                bgcolor: (0, 0.4, 0.6, 1)
                
            ScrollView:
                StackLayout:
                    id: model_library_list

        TabbedPanel:
            id: figure_areas
            do_default_tab: False
            tab_width: None

            TabbedPanelItem:
                text: "+"
                size_hint_x: None
                width: self.texture_size[0] + 30
                AnchorLayout:
                    anchor_x: 'center'
                    anchor_y: 'center'
                    padding: (200, 200)                
                    StackLayout:
                        id: creation_tab_content
                        FixedHeightLabel:
                            text: "Create a new tab:"
                        BoxLayout:
                            orientation: 'horizontal'
                            size_hint_y: None
                            height: 50
                            Label:
                                text: "Custom tab name (optional):"
                            TextInput:
                                id: new_tab_name
                                text: ""
                        FixedHeightButton:
                            text: "Blank Tab"
                            on_release: root.create_new_tab(new_tab_name.text, None)
                        

        #Right - hand sidebars
        StyledSplitter:  # Library of models, edesigns, and datasets (associated w/edesigns)
            id: library_info_sidebar_splitter
            sizable_from: 'left'
            size_hint_x: None
            width: 500
            min_size: 0
            max_size: 1000

            BoxLayout:
                id: library_info_sidebar
                orientation: 'vertical'

                FixedHeightLabel:
                    text: "Library Item Info"
                    bgcolor: (0, 0.4, 0.6, 1)

                AnchorLayout:
                    anchor_x: 'center'
                    anchor_y: 'center'
                    padding: (20, 10)
                    StackLayout:
                        id: library_info_area
    
        StyledSplitter:
            id: figure_properties_sidebar_splitter
            sizable_from: 'left'
            size_hint_x: None
            width: 500
            min_size: 0
            max_size: 1000
            
            StackLayout:
                id: figure_properties_sidebar
                #orientation: 'vertical'

        StyledSplitter:
            id: figure_info_sidebar_splitter
            sizable_from: 'left'
            size_hint_x: None
            width: 500
            min_size: 0
            max_size: 1000
            
            BorderedBoxLayout:
                id: figure_info_sidebar
                orientation: 'vertical'

                FixedHeightLabel:
                    text: 'Information'
                    bgcolor: (0, 0.4, 0.6, 1)

                BoxLayout:
                    orientation: 'vertical'

                    StackLayout:
                        id: upper_info_area
                        #orientation: 'vertical'

                    BoxLayout:
                        id: lower_info_area
                        orientation: 'vertical'
                        Label:
                            text: "Context-specific info goes here"

                    BoxLayout:
                        orientation: 'vertical'
                        FixedHeightLabel:
                            text: "Comments:"
                        AnchorLayout:
                            anchor_x: 'center'
                            anchor_y: 'center'
                            padding: (20, 20)
                            TextInput:
                                id: comment_input
                                text: ""
                                multiline: True
                            
                        #FixedHeightButton:
                        #    text: "Update"
                        #    on_release: root.save_comment_text(comment_input.text)


                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    #height: 40
                    #Button:
                    #    text: "Open analysis..."
                    #    on_release: root.open_analysis()

                    FixedHeightButton:
                        text: "Save analysis"
                        on_release: root.resave_analysis()
                    
                    FixedHeightButton:
                        text: "Save analysis as..."
                        on_release: root.save_analysis()
 
#                TabbedPanel:
#                    do_default_tab: False
#                    TabbedPanelItem:
#                        id: create_tab
#                        text: 'Create'
#    
#                    TabbedPanelItem:
#                        id: info_tab
#                        text: 'Info'
#                        BoxLayout:
#                            id: info_layout
#                            orientation: 'vertical'
#                            Label:
#                                text: "Info goes here"
  
    BorderedBoxLayout:
        id: bottom_bar
        orientation: 'horizontal'
        size_hint_y: None
        height: 50
    
        Label:
            id: status_label
            text: 'Ready for action.'


<FigureAreaWidget>:
    bar_pos_x: 'bottom'
    bar_pos_y: 'right'
    bar_width: 15
    bar_color: (1, 1, 1, 0.9)
    bar_inactive_color: (1, 1, 1, 0.2)
    scroll_type: ['bars', 'content']
    #resultsdir_selector_widget : results_dir_selector
    #results_selector_widget: results_selector
    #resultdetail_selector_widget: result_detail_selector

    DataAreaWidget:
        id: data_area
        root_widget: root.root_widget  # root_id
        size_hint: (None, None)
        size: (500, 500)

<CloseableHeader>
    color: 0,0,0,0
    #disabled_color: self.color
    # variable tab_width
    size_hint_x: None
    width: self.texture_size[0] + 60
    BoxLayout:
        pos: root.pos
        size_hint: None, None
        size: root.size
        padding: 3
        Label:
            id: name
            text: root.text
            on_touch_down: root.edit_name_and_order(args[1]) if self.collide_point(*args[1].pos) else None
                
        Button:
            padding: (0,0)
            color: (1,0,0,1)
            text: 'x'
            size_hint_x: None
            width: 40
            on_press:
                root.content.root_widget.close_tab(root)
            #font_size: 14
            #orientation: 'vertical'
            #Image:
            #    source: 'tools/theming/defaulttheme/close.png'
            #    on_touch_down:
            #        if self.collide_point(*args[1].pos) :\
            #            root.panel.remove_widget(root); \


            

<LoadRootDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            dirselect: True
            path: root.initial_path

        BoxLayout:
            size_hint_y: None
            height: 60
            Label:
                text: 'Name'
            TextInput:
                id: root_name

        BoxLayout:
            size_hint_y: None
            height: 60
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection, root_name.text)


<OpenDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            dirselect: False
            path: root.initial_path
            filters: root.filters

        BoxLayout:
            size_hint_y: None
            height: 60
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                on_release: root.load(filechooser.path, filechooser.selection)


<SaveDialog>:
    id: save_dialog
    filename: filename

    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        FileChooserListView:
            id: filechooser
            dirselect: True
            path: root.initial_path
            filters: ['*.json']

        BoxLayout:
            size_hint_y: None
            height: 60

            Label:
                text: "Filename:"
                size_hint_x: 0.3
            TextInput:
                id: filename
                text: filechooser.selection[0] if len(filechooser.selection) else ''
                size_hint_x: 0.7
                multiline: False

        BoxLayout:
            size_hint_y: None
            height: 60
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.path, filechooser.selection, filename.text)


<EditTabDialog>:
    id: edit_tab_dialog

    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        BoxLayout:
            size_hint_y: None
            height: 60

            Label:
                text: "Tab name:"
                size_hint_x: 0.3
            TextInput:
                id: tab_name_input
                text: root.tab_name
                size_hint_x: 0.7
                multiline: False

        BoxLayout:
            size_hint_y: None
            height: 60
            Button:
                text: "Move left"
                on_release: root.reorder('left')
            Button:
                text: "Ok"
                on_release: root.ok(tab_name_input.text)
            Button:
                text: "Cancel"
                on_release: root.cancel()                
            Button:
                text: "Move right"
                on_release: root.reorder('right')


<CustomAccordionTitle>:
    canvas.before:
        Color:
            rgb: 1, 1, 1
        BorderImage:
            source:
                root.item.background_normal if root.item.collapse else root.item.background_selected
            pos: self.pos
            size: self.size
        PushMatrix
        Translate:
            xy: self.center_x, self.center_y
        Rotate:
            angle: 90 if root.item.orientation == 'horizontal' else 0
            axis: 0, 0, 1
        Translate:
            xy: -self.center_x, -self.center_y
    canvas.after:
        PopMatrix
